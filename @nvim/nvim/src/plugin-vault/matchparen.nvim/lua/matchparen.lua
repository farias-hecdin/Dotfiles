local a=require('matchparen.options')local b=require('matchparen.highlight')local c=vim.fn;local d=a.opts;local e={}local function f(g)return c.exists('#'..g)~=0 end;local function h()local i={}local j=vim.opt_local.matchpairs:get()for k,l in ipairs(j)do local m,n=l:match('(.+):(.+)')i[m]=n end;return i end;local function o()if d.cached_matchpairs==vim.bo.matchpairs then return end;d.cached_matchpairs=vim.bo.matchpairs;d.matchpairs={}for p,q in pairs(h())do d.matchpairs[p]={left=p,right=q,backward=false}d.matchpairs[q]={left=p,right=q,backward=true}end end;local function r()if f(d.augroup_name)then return end;local s=vim.api.nvim_create_augroup(d.augroup_name,{})local t=function(u,v,w)local x={group=s,callback=v}if w then x=vim.tbl_extend('error',x,w)end;vim.api.nvim_create_autocmd(u,x)end;t('InsertEnter',function()b.update(true)end,{desc="Highlight matching pairs"})t({'WinEnter','CursorMoved','CursorMovedI','TextChanged','TextChangedI'},function()b.update(false)end,{desc="Highlight matching pairs"})t({'WinLeave','BufLeave'},function()b.remove()end,{desc="Hide matching pairs highlight"})t({'WinEnter','BufWinEnter','FileType'},function()o()end,{desc="Update cache of matchpairs option"})t('OptionSet',function()o()end,{pattern='matchpairs',desc="Update cache of matchpairs option"})end;local function y()if f(d.augroup_name)then vim.api.nvim_del_augroup_by_name(d.augroup_name)end end;local function z()vim.g.loaded_matchparen=1;if c.exists(':NoMatchParen')~=0 then vim.cmd('NoMatchParen')end;y()end;local function A()r()o()b.update(false)end;local function B()y()b.remove()end;local function C()vim.api.nvim_create_user_command('MatchParenEnable',A,{})vim.api.nvim_create_user_command('MatchParenDisable',B,{})end;function e.setup(x)z()a:update(x)o()C()if d.on_startup then r()b.update(false)end end;return e
