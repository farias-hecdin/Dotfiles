local a=require('lint.util')local b={error=vim.diagnostic.severity.ERROR,warning=vim.diagnostic.severity.WARN}local function c()local d=vim.fn.expand('%:p')local e=vim.fn.has('win32')==1 and'\\'or'/'local f='tests'..e..'test'..e;if not d:match(f)then return end;local g=a.find_nearest_directory('tests')return'--include='..g end;return{cmd='inko',args={'build',c,'--format=json','--check'},stream='stderr',stdin=false,ignore_exitcode=true,parser=function(h,i)local j={}if h==''then return j end;local k=vim.json.decode(h)or{}local l=vim.fn.expand('%:p')for i,m in ipairs(k)do if m.file==l then table.insert(j,{source='inko',lnum=m.line-1,col=m.column-1,end_lnum=m.line-1,end_col=m.column,message=m.message,severity=assert(b[m.level],'missing mapping for severity '..m.level)})end end;return j end}
