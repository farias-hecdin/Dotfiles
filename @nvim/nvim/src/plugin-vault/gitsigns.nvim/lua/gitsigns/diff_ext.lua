local a=require('gitsigns.git').diff;local b=require('gitsigns.hunks')local c=require('gitsigns.util')local d=require('gitsigns.async').scheduler;local e={}local function f(g,h)local i,j=io.open(g,'wb')if i==nil then error(j)end;for k,l in ipairs(h)do i:write(l)i:write('\n')end;i:close()end;function e.run_diff(m,n,o,p)local q={}if vim.in_fast_event()then d()end;local r=c.tmpname()local s=c.tmpname()f(r,n)f(s,m)local t=a(s,r,p,o)for k,u in ipairs(t)do if vim.startswith(u,'@@')then q[#q+1]=b.parse_diff_line(u)elseif#q>0 then local v=q[#q]if u:sub(1,1)=='-'then v.removed.lines[#v.removed.lines+1]=u:sub(2)elseif u:sub(1,1)=='+'then v.added.lines[#v.added.lines+1]=u:sub(2)end end end;os.remove(r)os.remove(s)return q end;return e
