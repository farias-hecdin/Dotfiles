local a={}a[1]=vim.diagnostic.severity.ERROR;a[2]=vim.diagnostic.severity.WARN;a[3]=vim.diagnostic.severity.INFO;a[4]=vim.diagnostic.severity.HINT;a[5]=vim.diagnostic.severity.HINT;return{cmd='phpmd',stdin=true,args={'-','json','cleancode,codesize,controversial,design,naming,unusedcode'},stream='stdout',ignore_exitcode=true,parser=function(b,c)if vim.trim(b)==''or b==nil then return{}end;if not vim.startswith(b,'{')then vim.notify(b)return{}end;local d=vim.json.decode(b)local e={}local f={}if d['files']and d['files'][1]and d['files'][1]['violations']then f=d['files'][1]['violations']end;for c,g in ipairs(f or{})do table.insert(e,{lnum=g.beginLine-1,end_lnum=g.endLine-1,col=0,end_col=0,message=g.description,code=g.rule,source='phpmd',severity=assert(a[g.priority],'missing mapping for severity '..g.priority)})end;return e end}
