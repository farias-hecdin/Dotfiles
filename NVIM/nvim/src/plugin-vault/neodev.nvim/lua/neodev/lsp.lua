local a=require("neodev.util")local b={}function b.setup()local c=require("neodev.config").options;local d=require("lspconfig.util")local e=d.add_hook_after;d.on_setup=e(d.on_setup,function(f)if c.setup_jsonls and f.name=="jsonls"then b.setup_jsonls(f)end;if f.name=="lua_ls"then f.on_new_config=e(f.on_new_config,b.on_new_config)end end)end;function b.setup_jsonls(f)local g=f.settings.json and f.settings.json.schemas or{}table.insert(g,{name="LuaLS Settings",url="https://raw.githubusercontent.com/LuaLS/vscode-lua/master/setting/schema.json",fileMatch={".luarc.json",".luarc.jsonc"}})f.settings=vim.tbl_deep_extend("force",f.settings,{json={schemas=g,validate={enable=true}}})end;function b.before_init(h,f)b.on_new_config(f,h.rootPath)end;function b.on_new_config(f,i)if f.settings.legacy then a.warn("You're using the old way of setting up neodev (previously lua-dev).\nPlease check the docs at https://github.com/folke/neodev.nvim#-setup")return end;local j=a.find_root()local c=require("neodev.config").merge()c.library.enabled=a.is_nvim_config()if not c.library.enabled and j then c.library.enabled=true;c.library.plugins=false end;pcall(function()c=require("neoconf").get("neodev",c,{file=i})end)pcall(c.override,i,c.library)local k=f.settings and f.settings.Lua and f.settings.Lua.workspace and f.settings.Lua.workspace.library or{}local l=f.settings and f.settings.Lua and f.settings.Lua.workspace and f.settings.Lua.workspace.ignoreDir or{}if c.library.enabled then f.settings=vim.tbl_deep_extend("force",f.settings or{},require("neodev.luals").setup(c,f.settings).settings)for m,n in ipairs(k)do table.insert(f.settings.Lua.workspace.library,n)end;if require("neodev.config").options.pathStrict and j then table.insert(f.settings.Lua.workspace.library,j)end;for m,o in ipairs(l)do table.insert(f.settings.Lua.workspace.ignoreDir,o)end end end;return b
