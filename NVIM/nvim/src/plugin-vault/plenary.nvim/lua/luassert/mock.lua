local a=require'luassert.spy'local b=require'luassert.stub'local function c(d,e)if type(d)~="table"then return end;if a.is_spy(d)then return d[e](d)end;for f,g in pairs(d)do c(g,e)end;return d end;local h;h={new=function(d,i,j,self,k)local l={}local function m(d,self,k)local n={["table"]=function()if a.is_spy(d)or l[d]then return end;l[d]=true;for f,g in pairs(d)do d[f]=m(g,d,f)end;return d end,["function"]=function()if i then return b(self,k,j)elseif self==nil then return a.new(d)else return a.on(self,k)end end}local o=n[type(d)]return o and o()or d end;return m(d,self,k)end,clear=function(d)return c(d,"clear")end,revert=function(d)return c(d,"revert")end}return setmetatable(h,{__call=function(self,...)return h.new(...)end})
