local a="lua/telescope/profile/lua_profiler.lua"local b="0.0000"local c="~"local d=75;local e=22;local f=6;local g=7;local h=6;local i=4;local j=" > Report saved to"local k="| %-"..d.."s: %-"..e.."s: %-"..f.."s: %-"..g.."s: %-"..h.."s: %-"..i.."s|\n"local l="%-"..d.."."..d.."s: %-"..e.."."..e.."s: %-"..f.."s"local m="| %s: %-"..g.."s: %-"..h.."s: %-"..i.."s|\n"local n="TOTAL TIME   = %f s\n"local o="%"..f-2 .."i"local p="%04.4f"local q="%03.1f"local r="%"..i-1 .."i"local s=string.format(k,"FILE","FUNCTION","LINE","TIME","%","#")local t={}local u=os.clock;local string=string;local debug=debug;local table=table;local v={}local w={}local x=0;local y=0;local z=0;local A=nil;local B=false;local function C(D)local E=D.short_src;if E==nil then E="<C>"elseif string.sub(E,#E-3,#E)==".lua"then E=string.sub(E,1,#E-4)end;local F=D.name;if F==nil then F="Anon"elseif string.sub(F,#F-1,#F)=="_l"then F=string.sub(F,1,#F-2)end;local G=string.format(l,E,F,string.format(o,D.linedefined or 0))local H=v[G]if not H then H={title=string.format(l,E,F,string.format(o,D.linedefined or 0)),count=0,timer=0}v[G]=H;x=x+1;w[x]=H end;return H end;local I=function(J)local D=debug.getinfo(2,"nS")if J=="call"then local H=C(D)H.callTime=u()H.count=H.count+1 elseif J=="return"then local H=C(D)if H.callTime and H.count>0 then H.timer=H.timer+u()-H.callTime end end end;local function K(L,M)local N=""M=M or" "for O=1,L do N=N..M end;return N end;local function P(Q,R)for O in string.gmatch(Q,R)do do return true end end;return false end;local S=K(#s-1,"-").."\n"function t.attachPrintFunction(T,U)A=T;if U~=nil then B=U end end;function t.start()v={}w={}x=0;y=u()z=nil;debug.sethook(I,"cr",0)end;function t.stop()z=u()debug.sethook()end;function t.report(V)if z==nil then t.stop()end;if x>0 then V=V or"profiler.log"table.sort(w,function(W,X)return W.timer>X.timer end)local Y=io.open(V,"w+")if x>0 then local Z=false;local _=z-y;local a0=" > "..string.format(n,_)Y:write(a0)if A~=nil then A(a0)end;Y:write("\n"..S)Y:write(s)Y:write(S)for a1=1,x do local H=w[a1]if H.count>0 and H.timer<=_ then local a2=true;if a~=""then if P(H.title,a)then a2=false end end;if a2==true then if P(H.title,"[[C]]")then a2=false end end;if a2==true then local a3=string.format(r,H.count)local a4=string.format(p,H.timer)local a5=string.format(q,H.timer/_*100)if Z==false and a4==b then Y:write(S)Z=true end;if a4==b then a4=c;a5=c end;local a6=string.format(m,H.title,a4,a5,a3)Y:write(a6)if A~=nil and B==true then A(a6)end end end end;Y:write(S)end;Y:close()if A~=nil then A(j.."'"..V.."'")end end end;return t
