local a={}function a.with(b,c)if type(b)=="function"then b=coroutine.create(b)end;if type(b)=="thread"then local d,e=coroutine.resume(b)assert(d,"Should have yielded in coroutine.")local f,g=pcall(c,e)local h,i=coroutine.resume(b)assert(h,"Should be done")local j=not coroutine.resume(b)assert(j,"Should not yield anymore, otherwise that would make things complicated")assert(f,g)return g else assert(b.enter)assert(b.exit)local e=b:enter()local f,g=pcall(c,e)b:exit()assert(f,g)return g end end;function a.open(k,l)if type(k)=="table"and k.filename then k=k.filename end;local m=assert(io.open(k,l))return coroutine.create(function()coroutine.yield(m)m:close()end)end;return a
