local a=vim.api;local b=vim.fn;local c=vim.uv or vim.loop;local d=c.os_uname().sysname;local e=require("url-open.modules.patterns")local f={}f.matches_file_patterns=function(g,h)if type(g)=="string"then g={g}end;if g==nil or#g==0 then return not h end;local i=a.nvim_buf_get_name(0)for j,k in ipairs(g)do if i:match(k)then return true end end;return false end;f.matches_condition_pattern=function(l,m)if type(m)=="function"then m=m(l)end;return type(m)~="boolean"and true or m end;f.find_first_matching_url=function(n,o,p,q)p=p or 1;q=q or#n;local r,s,t=nil,nil,nil;for j,u in ipairs(o)do if not f.matches_file_patterns(u.excluded_file_patterns,true)and f.matches_file_patterns(u.file_patterns)then local v,w,x=n:find(u.pattern,p)if x and q>v and f.matches_condition_pattern(x,u.extra_condition)then q=v;t=(u.prefix or"")..x..(u.suffix or"")r,s=v,w end end end;return r,s,t end;f.find_first_url_in_line=function(y,n,p)local r,s,t=f.find_first_matching_url(n,e.PATTERNS,p)local z,A,B=f.find_first_matching_url(n,y.extra_patterns,p,r)if z then r,s,t=z,A,B end;if y.deep_pattern then local C=b.matchstrpos(n,e.DEEP_PATTERN,p)if C[1]~=""and(r or#n)>=C[2]+1 then r,s,t=C[2]+1,C[3],C[1]end end;return r,s,t end;f.open_url_with_app=function(D,x)for j,E in ipairs(D)do if b.executable(E)==1 then local F=E.." "..b.shellescape(x)b.jobstart(F,{detach=true,on_exit=function(j,G,j)if G~=0 then require("url-open.modules.logger").error("Failed to open "..x)else require("url-open.modules.logger").info("Opening "..x)end end})return end end;require("url-open.modules.logger").error(string.format("Cannot find any of the following applications to open the URL: %s on %s. Please install one of these applications or add your preferred app to the URL options.",table.concat(D,", "),d))end;f.system_open_url=function(y,x)if x then local H=y.open_app;if H=="default"or H==""then if d=="Linux"then f.open_url_with_app({"xdg-open","gvfs-open","gnome-open","wslview"},x)elseif vim.loop.os_uname().sysname=="Darwin"then f.open_url_with_app({"open"},x)elseif vim.loop.os_uname().sysname=="Windows"then f.open_url_with_app({"start"},x)else require("url-open.modules.logger").error("Unknown operating system")end else f.open_url_with_app({H},x)end else require("url-open.modules.logger").error("No url found")end end;f.foreach_url_in_line=function(y,I,J)local r,s,x=f.find_first_url_in_line(y,I)while x do if J(x,r,s)then return end;r,s,x=f.find_first_url_in_line(y,I,s+1)end end;f.open_url=function(y)local K=a.nvim_win_get_cursor(0)local L=K[2]local I=a.nvim_get_current_line()local M=nil;f.foreach_url_in_line(y,I,function(x,r,s)if y.open_only_when_cursor_on_url then if L>=r-1 and L<s then M=x;return true end else M=x;return L<s end end)f.system_open_url(y,M)end;return f
